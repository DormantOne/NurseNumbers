<!DOCTYPE html>
<html>
<head>
  <title>Select Nurses and Phone Numbers</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCYDVebdIbJ7DV_tkqvl6dXacP2gd-V6zo",
  authDomain: "nurse-numbers.firebaseapp.com",
  databaseURL: "https://nurse-numbers-default-rtdb.firebaseio.com",
  projectId: "nurse-numbers",
  storageBucket: "nurse-numbers.appspot.com",
  messagingSenderId: "316071093036",
  appId: "1:316071093036:web:233a3bf23d007bb0a2c289",
  measurementId: "G-RW2RPJS2GC"
};


    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let selectedNurses = [];
    let selectedNumbers = [];
    let nurseNumberLinks = {};

    window.updateLinkSection = function() {
      const linkSelection = document.getElementById('linkSelection');
      linkSelection.innerHTML = '';
      selectedNurses.forEach(nurse => {
        const index = nurses.indexOf(nurse);
        linkSelection.innerHTML += `
          <div>
            <label for="dropdown${index}">${nurse}</label>
            <select id="dropdown${index}" onchange="updateLinks('${nurse}', this.value)">
              <option value="">Select Number</option>
              ${selectedNumbers.map(number => `<option value="${number}"${nurseNumberLinks[nurse] === number ? ' selected' : ''}>${number}</option>`).join('')}
            </select>
          </div>
        `;
      });
    }

    window.updateLinks = function(nurse, number) {
      nurseNumberLinks[nurse] = number;
    }

    window.submitSelection = async function() {
      const timestamp = new Date().toLocaleString();
      const data = {
        selectedNurses,
        selectedNumbers,
        nurseNumberLinks,
        timestamp
      };

      await set(ref(db, '/selections'), data);

      const selectedDiv = document.getElementById('selected');
      selectedDiv.innerHTML = `
        <p>Selected Nurses: ${selectedNurses.join(', ')}</p>
        <p>Selected Numbers: ${selectedNumbers.join(', ')}</p>
        <p>Nurse-Number Links: ${JSON.stringify(nurseNumberLinks)}</p>
        <p>Timestamp: ${timestamp}</p>
      `;
    }

    window.onload = async function() {
      const snapshot = await get(ref(db, '/selections'));
      if (snapshot.exists()) {
        const data = snapshot.val();
        selectedNurses = data.selectedNurses;
        selectedNumbers = data.selectedNumbers;
        nurseNumberLinks = data.nurseNumberLinks;

        data.selectedNurses.forEach(nurse => {
          const index = nurses.indexOf(nurse);
          if (index > -1) {
            document.getElementById('nurse' + index).checked = true;
          }
        });
        data.selectedNumbers.forEach(number => {
          const index = numbers.indexOf(number);
          if (index > -1) {
            document.getElementById('number' + index).checked = true;
          }
        });

        updateLinkSection();

        const selectedDiv = document.getElementById('selected');
        selectedDiv.innerHTML = `
          <p>Selected Nurses: ${data.selectedNurses.join(', ')}</p>
          <p>Selected Numbers: ${data.selectedNumbers.join(', ')}</p>
          <p>Nurse-Number Links: ${JSON.stringify(data.nurseNumberLinks)}</p>
          <p>Timestamp: ${data.timestamp}</p>
        `;
      }
    }
  </script>
</head>
<body>
  <h2>Select Nurses:</h2>
  <div id="nurseSelection"></div>

  <h2>Select Phone Numbers:</h2>
  <div id="numberSelection"></div>

  <h2>Link Nurses to Numbers:</h2>
  <div id="linkSelection"></div>

  <button type="button" onclick="submitSelection()">Submit</button>

  <h2>Selected:</h2>
  <div id="selected"></div>

  <script>
    const nurses = ['Nurse 1', 'Nurse 2', 'Nurse 3', 'Nurse 4', 'Nurse 5', 'Nurse 6', 'Nurse 7', 'Nurse 8', 'Nurse 9', 'Nurse 10'];
    const numbers = ['Number 1', 'Number 2', 'Number 3', 'Number 4', 'Number 5', 'Number 6', 'Number 7', 'Number 8', 'Number 9', 'Number 10'];

    const nurseSelection = document.getElementById('nurseSelection');
    const numberSelection = document.getElementById('numberSelection');

    nurses.forEach((nurse, index) => {
      nurseSelection.innerHTML += `
        <div>
          <input type="checkbox" id="nurse${index}" name="nurse" value="${nurse}" onchange="if (this.checked) { selectedNurses.push('${nurse}'); } else { const i = selectedNurses.indexOf('${nurse}'); if (i > -1) { selectedNurses.splice(i, 1); } delete nurseNumberLinks['${nurse}']; } updateLinkSection();">
          <label for="nurse${index}">${nurse}</label>
        </div>
      `;
    });

    numbers.forEach((number, index) => {
      numberSelection.innerHTML += `
        <div>
          <input type="checkbox" id="number${index}" name="number" value="${number}" onchange="if (this.checked) { selectedNumbers.push('${number}'); } else { const i = selectedNumbers.indexOf('${number}'); if (i > -1) { selectedNumbers.splice(i, 1); } Object.keys(nurseNumberLinks).forEach(nurse => { if (nurseNumberLinks[nurse] === '${number}') { delete nurseNumberLinks[nurse]; } }); } updateLinkSection();">
          <label for="number${index}">${number}</label>
        </div>
      `;
    });
  </script>
</body>
</html>
